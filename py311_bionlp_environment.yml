# py311_bionlp_environment.yml
# Python 3.11 BioNLP Environment with Resolved Dependencies
# Optimized for Medical NER Pipeline with spaCy ecosystem

name: py311_bionlp
channels:
  - conda-forge
  - defaults
  - huggingface
  - pytorch
dependencies:
  # Core Python 3.11 (compatible with medspacy constraints)
  - python=3.11.5
  - pip=23.2.1
  
  # Core data science stack
  - numpy=1.24.4
  - pandas=2.0.3
  - scipy=1.11.2
  - scikit-learn=1.3.0
  
  # NLP Core - Using spaCy 3.7.x (satisfies most constraints)
  - spacy=3.7.2  # Compatible with medspacy<3.8, negspacy>=3.0.1, transformers>=3.5.0
  
  # Essential utilities
  - tqdm=4.66.1
  - requests=2.31.0
  - setuptools=68.0.0
  
  # Data handling
  - openpyxl=3.1.2
  - xlsxwriter=3.1.9
  - jsonlines=3.1.0
  
  # Visualization and Dashboard
  - matplotlib=3.7.2
  - seaborn=0.12.2
  - plotly=5.17.0
  - streamlit=1.28.0
  
  # Deep Learning (PyTorch ecosystem)
  - pytorch=2.0.1
  - torchvision=0.15.2
  - torchaudio=2.0.2
  - cpuonly  # Remove if GPU needed
  
  # Development tools
  - jupyter=1.0.0
  - ipython=8.15.0
  - black=23.7.0
  - pytest=7.4.0
  
  # Text processing
  - nltk=3.8.1
  - regex=2023.8.8
  
  # System utilities
  - python-dateutil=2.8.2
  - pytz=2023.3
  - psutil=5.9.5
  
  # Install specialized medical NLP via pip
  - pip:
    # Medical NLP - Version resolved for compatibility
    - medspacy==1.3.1        # Requires spacy<3.8 ✓
    - negspacy==1.0.4        # Requires spacy>=3.0.1,<4.0.0 ✓  
    - spacy-transformers==1.3.5  # Compatible with spacy 3.7.x
    
    # Alternative to spacy-lookup (incompatible with modern spacy)
    # Using manual lookup implementation instead
    - spaczz==0.5.3          # Fuzzy matching for spaCy
    
    # SpaCy models (will be downloaded via script)
    # - en_core_web_sm
    # - en_core_web_md  
    # - en_core_web_lg
    # - en_core_web_trf (transformer model)
    
    # Transformers ecosystem
    - transformers==4.33.2
    - tokenizers==0.13.3
    - datasets==2.14.4
    
    # Additional NLP tools
    - textdistance==4.6.0
    - memory-profiler==0.61.0
    
    # Medical/Scientific models and tools
    - scispacy==0.5.3        # Scientific spaCy models
    
    # Performance monitoring
    - psutil==5.9.5
    - tqdm==4.66.1
    
    # Data validation and processing
    - pydantic==2.3.0
    - typer==0.9.0
    
    # Logging and configuration
    - loguru==0.7.0
    - python-dotenv==1.0.0
    
    # Export and reporting
    - jinja2==3.1.2
    - tabulate==0.9.0